<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title><?= title ?></title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        @page {
            size: A4 landscape;
            margin: 1.5cm; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© */
        }
        body {
            font-family: 'Sarabun', sans-serif;
            font-size: 10pt; 
            line-height: 1.4;
            margin: 0;
            -webkit-print-color-adjust: exact;
            print-color-adjust: exact;
            
            /* [‡πÉ‡∏´‡∏°‡πà] ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á "‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" */
            /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ö footer */
            padding-bottom: 2cm; 
        }
        .header { 
            text-align: center;
            margin-bottom: 20px; 
            border-bottom: 1px solid #333; 
            padding-bottom: 15px; 
        }
        .header-logo {
            width: 65px;
            height: 65px;
            margin: 0 auto 10px;
        }
        .header-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        .header-titles {
            text-align: center;
        }
        .header h1 { 
            margin: 0; 
            color: #000; 
            font-size: 15pt;
            font-weight: 600; 
        }
        .header h2 { 
            margin: 5px 0 0 0; 
            color: #222;
            font-size: 13pt;
            font-weight: 400; 
        }
        .header h3 { 
            margin: 5px 0 0 0;
            color: #000;
            font-size: 13pt;
            font-weight: 600; 
        }
        .info {
            text-align: right;
            margin-bottom: 15px;
            color: #555;
            font-size: 9pt;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            table-layout: fixed; 
        }
        th, td {
            border: 1px solid #dee2e6;
            padding: 6px 8px;
            text-align: left;
            vertical-align: top;
            word-break: break-word; 
            font-size: 9pt;
        }
        th {
            background-color: #f8f9fa;
            color: #212529;
            font-weight: 600;
            text-align: center;
            font-size: 10pt;
        }
        tr:nth-child(even) { background-color: #f8f9fa; }
        
        /* [‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç] ‡∏™‡πà‡∏ß‡∏ô Footer (‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô‡∏Å‡∏ß‡πà‡∏≤) */
        #page-footer {
            /* 1. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà */
            position: fixed; 
            
            /* 2. ‡∏¢‡∏∂‡∏î‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á, ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö‡∏ã‡πâ‡∏≤‡∏¢/‡∏Ç‡∏ß‡∏≤ ‡∏Ç‡∏≠‡∏á "‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå‡πÑ‡∏î‡πâ" */
            bottom: 0; 
            left: 0;
            right: 0;
            
            /* 3. ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏¥‡∏° (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô) */
            text-align: center; 
            color: #999;
            font-size: 9pt; 
            border-top: 1px solid #eee; 
            padding-top: 10px; 
            
            /* 4. [‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç] ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏°‡∏±‡∏ô‡πÄ‡∏≠‡∏á */
            /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡∏ô‡∏•‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
            padding-bottom: 5px;
            
            /* 5. ‡∏ï‡∏±‡πâ‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‡∏Å‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô */
            background-color: #ffffff;
        }
        /* === (‡∏à‡∏ö‡∏™‡πà‡∏ß‡∏ô Footer) === */

        .no-data {
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        
        .report-group {
            page-break-inside: avoid !important;
            margin-bottom: 25px;
        }
        .report-group-title {
            font-size: 14pt; 
            color: #1f2937; 
            border-bottom: 1px solid #ccc;
            padding-bottom: 5px; 
            margin-top: 30px;
            margin-bottom: 15px;
            font-weight: 600;
        }

        @media print {
            body { margin: 0; }
        }
    </style>
</head>
<body>
    <div id="page-footer">
        ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢ <?= systemTitle ?> | ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏î‡∏¢ ‡∏Ñ‡∏£‡∏π‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå ‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡∏ß
    </div>

    <div id="page-content">

        <div class="header">
            <div class="header-logo">
                <img src="https://img5.pic.in.th/file/secure-sv1/-205c460e57efb3b52b.png" alt="Logo">
            </div>
            <div class="header-titles">
                <h1><?= systemTitle ?></h1>
                <h2>‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ</h2>
                <h3><?= title ?></h3>
            </div>
        </div>
        
        <div class="info">
            ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: <?= new Date().toLocaleString('th-TH') ?> | 
            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£: <?= data.length ?> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
        </div>
        
        <? if (data && data.length > 0 && headers) { ?>
            
            <? if (title === '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô') { ?>
                <?
                let currentUser = null;
                const headerList = headers;
                let itemCounter = 1; 
                ?>

                <? data.forEach((row) => { ?>
                
                    <? if (row['‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°'] !== currentUser) { ?>
                        <? currentUser = row['‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°']; ?>
                        <? itemCounter = 1; ?>
                        
                        <? if (currentUser !== data[0]['‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°']) { ?>
                                    </tbody>
                                </table>
                            </div> 
                        <? } ?>

                        <div class="report-group">
                            <h3 class="report-group-title">üë®‚Äçüè´ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö: <?= currentUser ?></h3>
                            <table>
                                <thead>
                                    <tr>
                                        <th style="width: 5%; text-align: center;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                                        <th style="width: 20%;"><?= headerList[1] // ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ?></th>
                                        <th style="width: 10%; text-align: center;"><?= headerList[2] // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó ?></th>
                                        <th style="width: 8%; text-align: center;"><?= headerList[3] // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ?></th>
                                        <th style="width: 15%;"><?= headerList[4] // ‡∏´‡πâ‡∏≠‡∏á ?></th>
                                        <th style="width: 15%; text-align: center;"><?= headerList[5] // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° ?></th>
                                        <th style="width: 15%; text-align: center;"><?= headerList[6] // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô ?></th>
                                        <th style="width: 12%; text-align: center;"><?= headerList[7] // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ?></th>
                                    </tr>
                                </thead>
                                <tbody>
                    <? } ?>
                    
                    <tr>
                        <td style="text-align: center;"><?= itemCounter++ ?></td>
                        <td><?= row[headerList[1]] ?></td>
                        <td style="text-align: center;"><?= row[headerList[2]] ?></td>
                        <td style="text-align: center;"><?= row[headerList[3]] ?></td>
                        <td><?= row[headerList[4]] ?></td>
                        <td style="text-align: center;"><?= row[headerList[5]] ?></td>
                        <td style="text-align: center;"><?= row[headerList[6]] ?></td>
                        <td style="text-align: center;"><?= row[headerList[7]] ?></td>
                    </tr>

                <? }); ?>
                
                            </tbody>
                        </table>
                    </div> 

            <? } else { ?>
                <?
                const headerList = headers;
                
                function getHeaderStyle(header) {
                    let style = '';
                    switch (header) {
                        case '‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ': case '‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå': style = 'width: 35%;'; break; 
                        case '‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö': style = 'width: 15%;'; break; 
                        case '‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ': style = 'width: 12%;'; break; 
                        case '‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢)': style = 'width: 10%; text-align: center;'; break;
                        case '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠': case '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥': case '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': style = 'width: 6%; text-align: center;'; break; 
                        case '‡∏´‡∏ô‡πà‡∏ß‡∏¢': style = 'width: 4%; text-align: center;'; break; 
                    }
                    return style ? `style="${style}"` : '';
                }

                function getCellStyle(header) {
                    let style = '';
                    switch (header) {
                        case '‡∏Ñ‡∏ß‡∏£‡∏™‡∏±‡πà‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢)': case '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠': case '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥':
                        case '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞': case '‡∏´‡∏ô‡πà‡∏ß‡∏¢': case '‡∏™‡∏π‡∏ï‡∏£‡πÄ‡∏Ñ‡∏°‡∏µ':
                            style = 'text-align: center;'; break;
                    }
                    return style ? `style="${style}"` : '';
                }
                ?>
            
                <table>
                    <thead>
                        <tr>
                            <th style="width: 4%; text-align: center;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th> 
                            <? headerList.forEach(header => { ?>
                                <th <?= getHeaderStyle(header) ?>><?= header ?></th>
                            <? }); ?>
                        </tr>
                    </thead>
                    <tbody>
                        <? data.forEach((row, index) => { ?>
                            <tr>
                                <td style="text-align: center;"><?= index + 1 ?></td>
                                <? headerList.forEach(header => { ?>
                                    <td <?= getCellStyle(header) ?>><?= row[header] ?></td>
                                <? }); ?>
                            </tr>
                        <? }); ?>
                    </tbody>
                </table>
            <? } ?>
        
        <? } else { ?>
            <div class="no-data">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</div>
        <? } ?>

    </div> </body>
</html>
